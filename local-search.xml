<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>函数式编程中的 fix</title>
    <link href="/fix-in-functional-programming/"/>
    <url>/fix-in-functional-programming/</url>
    
    <content type="html"><![CDATA[<h1 id="先看看-fix-是什么"><a class="markdownIt-Anchor" href="#先看看-fix-是什么"></a> 先看看 fix 是什么</h1><p>这是 <code>fix</code> 在 Haskell 中的定义：</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">fix</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token hvariable">a</span> <span class="token operator">-></span> <span class="token hvariable">a</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token hvariable">a</span><span class="token hvariable">fix</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token keyword">let</span> <span class="token hvariable">x</span> <span class="token operator">=</span> <span class="token hvariable">f</span> <span class="token hvariable">x</span> <span class="token keyword">in</span> <span class="token hvariable">x</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><p>哇！好怪，这个 <code>x</code> 是什么？我们好像只能知道它满足 <code>x = f x</code>，但是这个值具体是怎么求的呢？</p><h1 id="那我们还是先看看-fix-的应用吧"><a class="markdownIt-Anchor" href="#那我们还是先看看-fix-的应用吧"></a> 那我们还是先看看 <code>fix</code> 的应用吧</h1><p>通常我们会这样定义阶乘。</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">fact</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token hvariable">fact</span> <span class="token number">0</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token hvariable">fact</span> <span class="token hvariable">n</span> <span class="token operator">=</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></div><p>如果转换成 lambda 表达式呢？</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">fact</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token hvariable">fact</span> <span class="token operator">=</span> <span class="token operator">\</span><span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span>              <span class="token keyword">then</span> <span class="token number">1</span>             <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">_</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><p>这个 <code>_</code> 应该填什么？对照上文的代码，我们应该要填入一个 <code>fact</code>。但是在这个 lambda 表达式中，<code>fact</code> 还没有被定义…</p><p>那我们可以试着多传一个参数作为参数穿进去。</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">fact</span> <span class="token operator">::</span> <span class="token punctuation">(</span><span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token hvariable">fact</span> <span class="token hvariable">f</span> <span class="token operator">=</span> <span class="token operator">\</span><span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span>               <span class="token keyword">then</span> <span class="token number">1</span>               <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></div><p>也就是说，我们需要向 <code>fact</code> 提供一个真正的阶乘函数来得到一个阶乘函数。按照这样的想法，我们可以写出这样的代码：</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">realFact</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token hvariable">realFact</span> <span class="token operator">=</span> <span class="token hvariable">fact</span> <span class="token hvariable">realFact</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></div><p>咦 <code>x = f x</code>，这不就是上面的 <code>fix</code> 吗？于是我们可以把 <code>fact</code> 定义成这样：</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">fact</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token hvariable">fact</span> <span class="token operator">=</span> <span class="token hvariable">fix</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">f</span> <span class="token hvariable">n</span> <span class="token operator">-></span>  <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span>   <span class="token keyword">then</span> <span class="token number">1</span>  <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><p>唔 那再给出几个常见的递归函数的 <code>fix</code> 实现以供参考。</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">fib</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span><span class="token hvariable">fib</span> <span class="token operator">=</span> <span class="token hvariable">fix</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">f</span> <span class="token hvariable">n</span> <span class="token operator">-></span>  <span class="token keyword">case</span> <span class="token hvariable">n</span> <span class="token keyword">of</span>  <span class="token number">0</span> <span class="token operator">-></span> <span class="token number">1</span>  <span class="token number">1</span> <span class="token operator">-></span> <span class="token number">1</span>  <span class="token hvariable">n'</span> <span class="token operator">-></span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n'</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n'</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token hvariable">eq</span> <span class="token operator">::</span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Int</span> <span class="token operator">-></span> <span class="token constant">Bool</span><span class="token hvariable">eq</span> <span class="token operator">=</span> <span class="token hvariable">fix</span> <span class="token operator">$</span> <span class="token operator">\</span><span class="token hvariable">f</span> <span class="token hvariable">n</span> <span class="token hvariable">m</span> <span class="token operator">-></span>  <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span>  <span class="token keyword">then</span> <span class="token hvariable">m</span> <span class="token operator">==</span> <span class="token number">0</span>  <span class="token keyword">else</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token hvariable">m</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h1 id="那-fix-是怎么计算的呢"><a class="markdownIt-Anchor" href="#那-fix-是怎么计算的呢"></a> 那 <code>fix</code> 是怎么计算的呢</h1><p>参考 SF-PLF-MoreStlc 一节中对 <code>fix</code> 的形式化定义，可以写出两条规约公式：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow><mi>t</mi><mo>→</mo><msup><mi>t</mi><mo mathvariant="normal">′</mo></msup></mrow><mrow><mtext>fix </mtext><mi>t</mi><mo>→</mo><mtext>fix </mtext><msup><mi>t</mi><mo mathvariant="normal">′</mo></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{t \rarr t&#x27;}{\text{fix } t \rarr \text{fix } t&#x27;}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.114892em;vertical-align:-0.686em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.428892em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">fix </span></span><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">fix </span></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6778919999999999em;"><span style="top:-2.9890000000000003em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord"><span class="mord mathdefault">t</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">′</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.686em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mfrac><mrow></mrow><mrow><mtext>fix </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mi>t</mi><mo stretchy="false">)</mo><mo>→</mo><mo stretchy="false">[</mo><mi>f</mi><mo>:</mo><mo>=</mo><mtext>fix </mtext><mo stretchy="false">(</mo><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mi>t</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mtext> </mtext><mi>t</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{}{\text{fix } (\lambda f.t)\rarr [f:=\text{fix } (\lambda f.t)]\,t}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.613em;vertical-align:-0.936em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.677em;"><span style="top:-2.314em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord text"><span class="mord">fix </span></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">[</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class="mord">fix </span></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mord mathdefault">t</span><span class="mclose">)</span><span class="mclose">]</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault">t</span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.677em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.936em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>那么，我们试着依照这个规则来计算 <code>fact 2</code>。</p><div class="code-wrapper"><pre class="line-numbers language-haskell" data-language="haskell"><code class="language-haskell"><span class="token hvariable">fact</span> <span class="token number">2</span><span class="token operator">=></span> <span class="token hvariable">fix</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">f</span> <span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">=></span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">2</span><span class="token operator">=></span> <span class="token keyword">if</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token number">1</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token hvariable">fix</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">f</span> <span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token number">1</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token number">0</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token hvariable">fix</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">f</span> <span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">f</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token operator">\</span><span class="token hvariable">n</span> <span class="token operator">-></span> <span class="token keyword">if</span> <span class="token hvariable">n</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token hvariable">n</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token punctuation">(</span><span class="token hvariable">n</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token number">0</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token keyword">then</span> <span class="token number">1</span> <span class="token keyword">else</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token hvariable">fact</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=></span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token number">1</span> <span class="token operator">*</span> <span class="token number">1</span><span class="token operator">=></span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><h1 id="从不动点的角度理解-fix"><a class="markdownIt-Anchor" href="#从不动点的角度理解-fix"></a> 从不动点的角度理解 <code>fix</code></h1><p>回到 <code>x = f x</code>，我们可以发现 <code>x</code> 就是 <code>f</code> 的一个不动点。</p><p>也就是说，对于某些点 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mn>0</mn></msub></mrow><annotation encoding="application/x-tex">x_0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>，令 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mrow><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_n = f(x_{n-1})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.301108em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">n</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.208331em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span>。当 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>→</mo><mo>+</mo><mi mathvariant="normal">∞</mi></mrow><annotation encoding="application/x-tex">n\rarr +\infty</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">→</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">+</span><span class="mord">∞</span></span></span></span> 时，<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>n</mi></msub><mo>=</mo><mi>f</mi><mo stretchy="false">(</mo><msub><mi>x</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">x_n = f(x_n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span></span></span></span></p><p>而对于 <code>fact</code>，先令 <code>ft = \f n -&gt; if n == 0 then 1 else n * f (n - 1)</code>。</p><p>如果我们令 <code>x0 = id</code>：</p><p><code>ft id</code> 可以正确计算所有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>≤</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">n \leq 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span></span></span></span></p><p><code>ft $ ft id</code> 可以正确计算所有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>≤</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">n \leq 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span></p><p><code>ft $ ft $ ft id</code> 可以正确计算所有 <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi><mo>≤</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">n \leq 2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mord mathdefault">n</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></p><p>…</p><p>最终，我们有 <code>fact = ft fact</code>，也就是说 <code>fact</code> 是 <code>ft</code> 的一个不动点。对 <code>id</code> 反复迭代 <code>ft</code> 就能逐渐逼近 <code>fact</code>。（实际上 <code>id</code> 可以换成任意一个类型为 <code>Int -&gt; Int</code> 的函数）</p><blockquote><p>值得一提的是，coq 中定义递归函数的关键字就是 <code>Fixpoint</code></p></blockquote><h1 id="fix-在-utlc-中的实现"><a class="markdownIt-Anchor" href="#fix-在-utlc-中的实现"></a> <code>fix</code> 在 utlc 中的实现</h1><p>不难发现，虽然我们通过 <code>fix</code> 实现了递归，但是在 stlc 中定义 <code>fix</code> 本身仍需要递归实现。</p><p>而在 utlc 里，我们可以通过 <code>Y-Combinator</code> 来实现 <code>fix</code>。</p><div class="code-wrapper"><pre class="line-numbers language-racket" data-language="racket"><code class="language-racket"><span class="token lang keyword">#lang lazy</span><span class="token punctuation">(</span><span class="token keyword">define</span> <span class="token punctuation">(</span><span class="token function">y-comb</span> f<span class="token punctuation">)</span>  <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">λ</span> <span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">f</span> <span class="token punctuation">(</span><span class="token function">x</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token punctuation">(</span><span class="token function">λ</span> <span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token function">f</span> <span class="token punctuation">(</span><span class="token function">x</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">define</span> fact  <span class="token punctuation">(</span><span class="token function">y-comb</span>   <span class="token punctuation">(</span><span class="token function">λ</span> <span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">)</span>     <span class="token punctuation">(</span><span class="token function">λ</span> <span class="token punctuation">(</span><span class="token function">x</span><span class="token punctuation">)</span>       <span class="token punctuation">(</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token number">0</span> x<span class="token punctuation">)</span>           <span class="token number">1</span>           <span class="token punctuation">(</span><span class="token operator">*</span> x <span class="token punctuation">(</span><span class="token function">f</span> <span class="token punctuation">(</span><span class="token operator">-</span> x <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><blockquote><p>这里使用 <code>lazy</code> 是因为 <code>Y-Combinator</code> 并不支持 strict。如果在 strict 下想实现 <code>fix</code> 可以参考 <code>Z-Combinator</code></p></blockquote><p>呜呜 这个 <code>y-comb</code> 看起来比前面那个还奇怪。让我们来代入一个 g 试试</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mtable rowspacing="0.24999999999999992em" columnalign="right left" columnspacing="0em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mi>Y</mi><mtext> </mtext><mi>g</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>f</mi><mi mathvariant="normal">.</mi><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>f</mi><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mi>g</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>g</mi><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>g</mi><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>g</mi><mtext> </mtext><mo stretchy="false">(</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>g</mi><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>λ</mi><mi>x</mi><mi mathvariant="normal">.</mi><mi>g</mi><mo stretchy="false">(</mo><mi>x</mi><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="true"><mrow><mrow></mrow><mo>=</mo><mi>g</mi><mtext> </mtext><mo stretchy="false">(</mo><mi>Y</mi><mtext> </mtext><mi>g</mi><mo stretchy="false">)</mo></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{aligned}Y\, g&amp;= (\lambda f . (\lambda x . f (x x)) (\lambda x . f(x x))) g \\&amp;= (\lambda x . g (x x)) (\lambda x . g (x x)) \\&amp;= g\, ((\lambda x . g (x x)) (\lambda x . g(x x))) \\&amp;= g\, (Y\, g)\end{aligned}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:6em;vertical-align:-2.7500000000000004em;"></span><span class="mord"><span class="mtable"><span class="col-align-r"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-2.4099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span><span style="top:-0.9099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7500000000000004em;"><span></span></span></span></span></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:3.25em;"><span style="top:-5.41em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mord">.</span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault">x</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault">x</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.10764em;">f</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span></span></span><span style="top:-3.91em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault">x</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault">x</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span></span></span><span style="top:-2.4099999999999993em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault">x</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathdefault">λ</span><span class="mord mathdefault">x</span><span class="mord">.</span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mopen">(</span><span class="mord mathdefault">x</span><span class="mord mathdefault">x</span><span class="mclose">)</span><span class="mclose">)</span><span class="mclose">)</span></span></span><span style="top:-0.9099999999999997em;"><span class="pstrut" style="height:3em;"></span><span class="mord"><span class="mord"></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mopen">(</span><span class="mord mathdefault" style="margin-right:0.22222em;">Y</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:2.7500000000000004em;"><span></span></span></span></span></span></span></span></span></span></span></span></p><p>这样就得到了与前面 <code>fix</code> 相同的表达式。<code>y-comb</code> 也就实现无中生有递归啦！</p>]]></content>
    
    
    
    <tags>
      
      <tag>fp</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
